pico-8 cartridge // http://www.pico-8.com
version 33
__lua__
--bad tic tac toe
--by kulpas

function _init()	
	act_p=flr(rnd(2))
	cx,cy=1,1
	pcol={12,14}
	t=0
	
	winmaps={
		0b111000000,
		0b000111000,
		0b000000111,
		0b100100100,
		0b010010010,
		0b001001001,
		0b100010001,
		0b001010100
	}
	
	marks=blankmap(-1)
	ani=blankmap(-1)
	tmers=blankmap()
	
	_upd=upd_turn
	_drw=drw_game
end

function _update()
	t+=1
	_upd()
end

function upd_turn()
	mov_cursor(act_p)
	if btnp(❎,act_p) and marks[cx][cy]==-1 then
		marks[cx][cy]=act_p
		ani[cx][cy]=0
		if not checkwin(act_p) then
			act_p=(act_p+1)%2
		end
	end
end

function upd_win()
	if btnp(❎) then
		_init()
	end
end

function checkwin(p)
	local bmaps={get_bmap(0),get_bmap(1)}
	
	for wmap in all(winmaps) do
		if bmaps[p+1]&wmap==wmap then
			_upd=upd_win
			_drw=drw_win
			return true
		end
	end
	
	if bmaps[1]|bmaps[2]==0b111111111 then
		_upd=upd_win
		_drw=drw_draw
	end
	
	return false
end

function get_bmap(p)
	local b=0
	for i=0,8 do
		if marks[i%3][i\3]==p then
			b+=1<<8-i
		end
	end
	return b
end

function mov_cursor(p)
	cx+=tonum(btnp(➡️,p))-tonum(btnp(⬅️,p))
	cy+=tonum(btnp(⬇️,p))-tonum(btnp(⬆️,p))
	cx,cy=mid(0,cx,2),mid(0,cy,2)
end
-->8
--draws
function _draw()
	_drw()
end

function drw_game()
	cls(5)
	--gridfill()

	draw_grid()	
	draw_cursor()
	draw_ox()
end

function drw_win()
	cls(pcol[act_p+1])
	--gridfill()
	print("player "..1+act_p.." wins!",36,61,7)
	print("press ❎ to play again",20,70,7)
end

function drw_draw()
	cls(5)
	print("it's a draw!",38,61,7)
	print("press ❎ to play again",20,70,7)
end

function draw_grid()
	for r=10,117 do
		circfill(44,r,2,7)
		circfill(83,r,2,7)
		circfill(r,44,2,7)
		circfill(r,83,2,7)
	end
end

function draw_cursor()
	local scx,scy=39*cx,39*cy
	for r=10+scx,39+scx do
		circfill(r,10+scy,1,pcol[act_p+1])
		circfill(r,39+scy,1,pcol[act_p+1])
	end
	for r=10+scy,39+scy do
		circfill(10+scx,r,1,pcol[act_p+1])
		circfill(39+scx,r,1,pcol[act_p+1])
	end
end

function draw_ox()
	for x=0,2 do
		for y=0,2 do
			local m=marks[x][y]
			pal()
		
			if m!=-1 then
				if t%2==0 then
					ani[x][y]=min(ani[x][y]+1,7)
				end
				set_pal(ani[x][y],m==0 and 12 or 14)
				spr(1+m*3,13+x*39,13+y*39,3,3)
			end
			print(ani[x][y],20+x*39,20+y*39,7)
		end
	end
end
-->8
-- tools
function gridfill()
	fillp(0b1010010110100101)
	local c1,c2
	for x=0,15 do
		for y=0,15 do
			local s=(x\2+y\2)%2==0
			c1,c2=s and 0x3b or 0x28, s and 0x1c or 0x9a
			rectfill(x*8,y*8,x*8+7,y*8+7,(x+y)%2==0 and c1 or c2)
		end
	end
	fillp()	
end

function blankmap(val)
	val=val or 0
	local ret={}
	for x=0,2 do
		ret[x]={}
		for y=0,2 do
			ret[x][y]=val
		end
	end
	return ret
end

function set_pal(len,col)
	for i=8,15 do
		pal(i,i<=8+len and col or 5)
	end
end
--[[
function log(txt,owrt)
	printh(txt,"log",owrt)
end
]]--
__gfx__
00000000000000000fff88800000000008880000000000000000ccc0000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000fffffff888880000008888800000000000000ccccc000000000000000000000000000000000000000000000000000000000000000000000000
0070070000000ffffffffff888800000888888000000000000cccccc000000000000000000000000000000000000000000000000000000000000000000000000
000770000000eeeff000000f8888000088888880000000000ccccccc000000000000000000000000000000000000000000000000000000000000000000000000
00077000000eeee000000000088880000888888800000000ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000
0070070000eee0000000000000088800008888899000000ddccccc00000000000000000000000000000000000000000000000000000000000000000000000000
000000000eeee000000000000009889000088899990000ddddccc000000000000000000000000000000000000000000000000000000000000000000000000000
000000000eee000000000000000099900000899999900ddddddc0000000000000000000000000000000000000000000000000000000000000000000000000000
00cccc000eee00000000000000009990000009999999ddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccc0edd0000000000000000009990000009999999ddddd000000000000000000000000000000000000000000000000000000000000000000000000000000
ccc00cccddd0000000000000000009990000000999999addd0000000000000000000000000000000000000000000000000000000000000000000000000000000
cc0000ccddd0000000000000000009990000000099999aad00000000000000000000000000000000000000000000000000000000000000000000000000000000
cc0000ccddd00000000000000000099900000000e999aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000
ccc00cccddd0000000000000000009990000000eeeaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccc0ddd000000000000000000a9a000000eeeeeaaaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000
00cccc000ddd0000000000000000aaa000000eeeeeeeaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000
ee0000ee0ddc0000000000000000aaa00000feeeeee00aaaaaab0000000000000000000000000000000000000000000000000000000000000000000000000000
eee00eee0dccc00000000000000aaaa0000fffeeee0000aaaabbb000000000000000000000000000000000000000000000000000000000000000000000000000
0eeeeee000dcc00000000000000aaa0000fffffee000000aabbbbb00000000000000000000000000000000000000000000000000000000000000000000000000
00eeee00000cccc0000000000aaaa0000fffffff00000000bbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000
00eeee000000ccccc000000baaaa0000fffffff0000000000bbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000
0eeeeee000000cccccbbbbbbbab00000ffffff000000000000bbbbbb000000000000000000000000000000000000000000000000000000000000000000000000
eee00eee000000cccbbbbbbbbb000000fffff00000000000000bbbbb000000000000000000000000000000000000000000000000000000000000000000000000
ee0000ee000000000bbbbbb0000000000fff0000000000000000bbb0000000000000000000000000000000000000000000000000000000000000000000000000
__label__
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555557775555555555555555555555555555555555557775555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555555555cccccc5555555555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555555cccccccccccc5555555555555555555
555555555555555555555555555555555555555555777775555555555555555555555555555555555777775555555555cccccccccccccc555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555ccccc555555ccccc55555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555cccc5555555555cccc5555555555555555
555555555555555555555555555555555555555555777775555555555555555555555555555555555777775555555ccc55555555555555ccc555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555cccc55555555555555cccc55555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555ccc5555555555555555ccc55555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555ccc5555555555555555ccc55555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555ccc5555555555555555ccc55555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555ccc5555555555555555ccc55555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555cccc55555555555555cccc55555555555555
555555555555555555555555555555555555555555777775555555555555555555555555555555555777775555555ccc55555555555555ccc555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555cccc5555555555cccc5555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555ccccc555555ccccc55555555555555555
555555555555555555555555555555555555555555777775555555555555555555555555555555555777775555555555cccccccccccccc555555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555555cccccccccccc5555555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555555555cccccc5555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555577777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777555555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555577777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555555cccccc5555555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555cccccccccccc5555555555577777555555555555555555555555555555555555555555
555555555555555555555555555555555555555555777775555555555cccccccccccccc555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555ccccc555555ccccc55555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555cccc5555555555cccc5555555577777555555555555555555555555555555555555555555
555555555555555555555555555555555555555555777775555555ccc55555555555555ccc555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555cccc55555555555555cccc55555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555ccc5555555555555555ccc55555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555ccc5555555555555555ccc55555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555ccc5555555555555555ccc55555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555ccc5555555555555555ccc55555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555cccc55555555555555cccc55555577777555555555555555555555555555555555555555555
555555555555555555555555555555555555555555777775555555ccc55555555555555ccc555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555cccc5555555555cccc5555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555ccccc555555ccccc55555555577777555555555555555555555555555555555555555555
555555555555555555555555555555555555555555777775555555555cccccccccccccc555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555cccccccccccc5555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555555cccccc5555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555577777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777555555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555577777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
5555555555cccccccccccccccccccccccccccccc5577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555cccccccccccccccccccccccccccccccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555cccccccccccccccccccccccccccccccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555ccc55555555555555555555555555ccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555ccc55eee5555555555555555eee55ccc577777555555555555555555555555555555555577777555555eee5555555555555555eee55555555555555
555555555ccc5eeeee55555555555555eeeee5ccc57777755555555555555555555555555555555557777755555eeeee55555555555555eeeee5555555555555
555555555ccc5eeeeee555555555555eeeeee5ccc57777755555555555555555555555555555555557777755555eeeeee555555555555eeeeee5555555555555
555555555ccc5eeeeeee5555555555eeeeeee5ccc57777755555555555555555555555555555555557777755555eeeeeee5555555555eeeeeee5555555555555
555555555ccc55eeeeeee55555555eeeeeee55ccc577777555555555555555555555555555555555577777555555eeeeeee55555555eeeeeee55555555555555
555555555ccc555eeeeeee555555eeeeeee555ccc5777775555555555555555555555555555555555777775555555eeeeeee555555eeeeeee555555555555555
555555555ccc5555eeeeeee5555eeeeeee5555ccc57777755555555555555555555555555555555557777755555555eeeeeee5555eeeeeee5555555555555555
555555555ccc55555eeeeeee55eeeeeee55555ccc577777555555555555555555555555555555555577777555555555eeeeeee55eeeeeee55555555555555555
555555555ccc555555eeeeeeeeeeeeee555555ccc5777775555555555555555555555555555555555777775555555555eeeeeeeeeeeeee555555555555555555
555555555ccc5555555eeeeeeeeeeee5555555ccc57777755555555555555555555555555555555557777755555555555eeeeeeeeeeee5555555555555555555
555555555ccc55555555eeeeeeeeee55555555ccc577777555555555555555555555555555555555577777555555555555eeeeeeeeee55555555555555555555
555555555ccc555555555eeeeeeee555555555ccc5777775555555555555555555555555555555555777775555555555555eeeeeeee555555555555555555555
555555555ccc555555555eeeeeeee555555555ccc5777775555555555555555555555555555555555777775555555555555eeeeeeee555555555555555555555
555555555ccc55555555eeeeeeeeee55555555ccc577777555555555555555555555555555555555577777555555555555eeeeeeeeee55555555555555555555
555555555ccc5555555eeeeeeeeeeee5555555ccc57777755555555555555555555555555555555557777755555555555eeeeeeeeeeee5555555555555555555
555555555ccc555555eeeeeeeeeeeeee555555ccc5777775555555555555555555555555555555555777775555555555eeeeeeeeeeeeee555555555555555555
555555555ccc55555eeeeeee55eeeeeee55555ccc577777555555555555555555555555555555555577777555555555eeeeeee55eeeeeee55555555555555555
555555555ccc5555eeeeeee5555eeeeeee5555ccc57777755555555555555555555555555555555557777755555555eeeeeee5555eeeeeee5555555555555555
555555555ccc555eeeeeee555555eeeeeee555ccc5777775555555555555555555555555555555555777775555555eeeeeee555555eeeeeee555555555555555
555555555ccc55eeeeeee55555555eeeeeee55ccc577777555555555555555555555555555555555577777555555eeeeeee55555555eeeeeee55555555555555
555555555ccc5eeeeeee5555555555eeeeeee5ccc57777755555555555555555555555555555555557777755555eeeeeee5555555555eeeeeee5555555555555
555555555ccc5eeeeee555555555555eeeeee5ccc57777755555555555555555555555555555555557777755555eeeeee555555555555eeeeee5555555555555
555555555ccc5eeeee55555555555555eeeee5ccc57777755555555555555555555555555555555557777755555eeeee55555555555555eeeee5555555555555
555555555ccc55eee5555555555555555eee55ccc577777555555555555555555555555555555555577777555555eee5555555555555555eee55555555555555
555555555ccc55555555555555555555555555ccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555cccccccccccccccccccccccccccccccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555cccccccccccccccccccccccccccccccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
5555555555cccccccccccccccccccccccccccccc5577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555557775555555555555555555555555555555555557775555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555

