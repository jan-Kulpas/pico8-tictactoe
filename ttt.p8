pico-8 cartridge // http://www.pico-8.com
version 33
__lua__
--bad tic tac toe
--by kulpas

function _init()	
	act_p=flr(rnd(2))
	cx,cy=1,1
	pcol={12,14}
	
	winmaps={
		0b111000000,
		0b000111000,
		0b000000111,
		0b100100100,
		0b010010010,
		0b001001001,
		0b100010001,
		0b001010100
	}
	
	marks=blankmap(-1)
	tmers=blankmap()
	
	_upd=upd_turn
	_drw=drw_game
end

function _update()
	_upd()
end

function upd_turn()
	mov_cursor(act_p)
	if btnp(❎,act_p) and marks[cx][cy]==-1 then
		marks[cx][cy]=act_p
		if not checkwin(act_p) then
			act_p=(act_p+1)%2
		end
	end
end

function upd_win()
	if btnp(❎) then
		_init()
	end
end

function checkwin(p)
	local bmaps={get_bmap(0),get_bmap(1)}
	
	for wmap in all(winmaps) do
		if bmaps[p+1]&wmap==wmap then
			_upd=upd_win
			_drw=drw_win
			return true
		end
	end
	
	if bmaps[1]|bmaps[2]==0b111111111 then
		_upd=upd_win
		_drw=drw_draw
	end
	
	return false
end

function get_bmap(p)
	local b=0
	for i=0,8 do
		if marks[i%3][i\3]==p then
			b+=1<<8-i
		end
	end
	return b
end

function mov_cursor(p)
	cx+=tonum(btnp(➡️,p))-tonum(btnp(⬅️,p))
	cy+=tonum(btnp(⬇️,p))-tonum(btnp(⬆️,p))
	cx,cy=mid(0,cx,2),mid(0,cy,2)
end
-->8
--draws
function _draw()
	_drw()
end

function drw_game()
	cls(5)
	--gridfill()

	draw_grid()	
	draw_cursor()
	draw_ox()
end

function drw_win()
	cls(pcol[act_p+1])
	--gridfill()
	print("player "..1+act_p.." wins!",36,61,7)
	print("press ❎ to play again",20,70,7)
end

function drw_draw()
	cls(5)
	print("it's a draw!",38,61,7)
	print("press ❎ to play again",20,70,7)
end

function draw_grid()
	for r=10,117 do
		circfill(44,r,2,7)
		circfill(83,r,2,7)
		circfill(r,44,2,7)
		circfill(r,83,2,7)
	end
end

function draw_cursor()
	local scx,scy=39*cx,39*cy
	for r=10+scx,39+scx do
		circfill(r,10+scy,1,pcol[act_p+1])
		circfill(r,39+scy,1,pcol[act_p+1])
	end
	for r=10+scy,39+scy do
		circfill(10+scx,r,1,pcol[act_p+1])
		circfill(39+scx,r,1,pcol[act_p+1])
	end
end

function draw_ox()
	for x=0,2 do
		for y=0,2 do
			local m=marks[x][y]
			if m!=-1 then
				spr(1+m*3,13+x*39,13+y*39,3,3)
			end
		end
	end
end
-->8
-- tools
function gridfill()
	fillp(0b1010010110100101)
	local c1,c2
	for x=0,15 do
		for y=0,15 do
			local s=(x\2+y\2)%2==0
			c1,c2=s and 0x3b or 0x28, s and 0x1c or 0x9a
			rectfill(x*8,y*8,x*8+7,y*8+7,(x+y)%2==0 and c1 or c2)
		end
	end
	fillp()	
end

function blankmap(val)
	val=val or 0
	local ret={}
	for x=0,2 do
		ret[x]={}
		for y=0,2 do
			ret[x][y]=val
		end
	end
	return ret
end
--[[
function log(txt,owrt)
	printh(txt,"log",owrt)
end
]]--
__gfx__
00000000000000000cccccc0000000000eee0000000000000000eee0000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000cccccccccccc000000eeeee00000000000000eeeee000000000000000000000000000000000000000000000000000000000000000000000000
0070070000000cccccccccccccc00000eeeeee000000000000eeeeee000000000000000000000000000000000000000000000000000000000000000000000000
000770000000ccccc000000ccccc0000eeeeeee0000000000eeeeeee000000000000000000000000000000000000000000000000000000000000000000000000
00077000000cccc0000000000cccc0000eeeeeee00000000eeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000
0070070000ccc00000000000000ccc0000eeeeeee000000eeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000
000000000cccc00000000000000cccc0000eeeeeee0000eeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000
000000000ccc0000000000000000ccc00000eeeeeee00eeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000
00cccc000ccc0000000000000000ccc000000eeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccc0ccc000000000000000000ccc000000eeeeeeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000
ccc00cccccc000000000000000000ccc0000000eeeeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000
cc0000ccccc000000000000000000ccc00000000eeeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
cc0000ccccc000000000000000000ccc00000000eeeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000
ccc00cccccc000000000000000000ccc0000000eeeeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccc0ccc000000000000000000ccc000000eeeeeeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000
00cccc000ccc0000000000000000ccc000000eeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000000
ee0000ee0ccc0000000000000000ccc00000eeeeeee00eeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000
eee00eee0cccc00000000000000cccc0000eeeeeee0000eeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000
0eeeeee000ccc00000000000000ccc0000eeeeeee000000eeeeeee00000000000000000000000000000000000000000000000000000000000000000000000000
00eeee00000cccc0000000000cccc0000eeeeeee00000000eeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000
00eeee000000ccccc000000ccccc0000eeeeeee0000000000eeeeeee000000000000000000000000000000000000000000000000000000000000000000000000
0eeeeee000000cccccccccccccc00000eeeeee000000000000eeeeee000000000000000000000000000000000000000000000000000000000000000000000000
eee00eee000000cccccccccccc000000eeeee00000000000000eeeee000000000000000000000000000000000000000000000000000000000000000000000000
ee0000ee000000000cccccc0000000000eee0000000000000000eee0000000000000000000000000000000000000000000000000000000000000000000000000
__label__
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555557775555555555555555555555555555555555557775555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555555555cccccc5555555555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555555cccccccccccc5555555555555555555
555555555555555555555555555555555555555555777775555555555555555555555555555555555777775555555555cccccccccccccc555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555ccccc555555ccccc55555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555cccc5555555555cccc5555555555555555
555555555555555555555555555555555555555555777775555555555555555555555555555555555777775555555ccc55555555555555ccc555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555cccc55555555555555cccc55555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555ccc5555555555555555ccc55555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555ccc5555555555555555ccc55555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555ccc555555555555555555ccc5555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555ccc5555555555555555ccc55555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555ccc5555555555555555ccc55555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555cccc55555555555555cccc55555555555555
555555555555555555555555555555555555555555777775555555555555555555555555555555555777775555555ccc55555555555555ccc555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555cccc5555555555cccc5555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555ccccc555555ccccc55555555555555555
555555555555555555555555555555555555555555777775555555555555555555555555555555555777775555555555cccccccccccccc555555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555555cccccccccccc5555555555555555555
5555555555555555555555555555555555555555557777755555555555555555555555555555555557777755555555555555cccccc5555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555577777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777555555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555577777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555555cccccc5555555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555cccccccccccc5555555555577777555555555555555555555555555555555555555555
555555555555555555555555555555555555555555777775555555555cccccccccccccc555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555ccccc555555ccccc55555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555cccc5555555555cccc5555555577777555555555555555555555555555555555555555555
555555555555555555555555555555555555555555777775555555ccc55555555555555ccc555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555cccc55555555555555cccc55555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555ccc5555555555555555ccc55555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555ccc5555555555555555ccc55555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555ccc555555555555555555ccc5555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555ccc5555555555555555ccc55555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555ccc5555555555555555ccc55555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555cccc55555555555555cccc55555577777555555555555555555555555555555555555555555
555555555555555555555555555555555555555555777775555555ccc55555555555555ccc555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555cccc5555555555cccc5555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555ccccc555555ccccc55555555577777555555555555555555555555555555555555555555
555555555555555555555555555555555555555555777775555555555cccccccccccccc555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555cccccccccccc5555555555577777555555555555555555555555555555555555555555
5555555555555555555555555555555555555555557777755555555555555cccccc5555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555577777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777555555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777755555555
55555555577777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777555555555
55555555555555555555555555555555555555555577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
5555555555cccccccccccccccccccccccccccccc5577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555cccccccccccccccccccccccccccccccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555cccccccccccccccccccccccccccccccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555ccc55555555555555555555555555ccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555ccc55eee5555555555555555eee55ccc577777555555555555555555555555555555555577777555555eee5555555555555555eee55555555555555
555555555ccc5eeeee55555555555555eeeee5ccc57777755555555555555555555555555555555557777755555eeeee55555555555555eeeee5555555555555
555555555ccc5eeeeee555555555555eeeeee5ccc57777755555555555555555555555555555555557777755555eeeeee555555555555eeeeee5555555555555
555555555ccc5eeeeeee5555555555eeeeeee5ccc57777755555555555555555555555555555555557777755555eeeeeee5555555555eeeeeee5555555555555
555555555ccc55eeeeeee55555555eeeeeee55ccc577777555555555555555555555555555555555577777555555eeeeeee55555555eeeeeee55555555555555
555555555ccc555eeeeeee555555eeeeeee555ccc5777775555555555555555555555555555555555777775555555eeeeeee555555eeeeeee555555555555555
555555555ccc5555eeeeeee5555eeeeeee5555ccc57777755555555555555555555555555555555557777755555555eeeeeee5555eeeeeee5555555555555555
555555555ccc55555eeeeeee55eeeeeee55555ccc577777555555555555555555555555555555555577777555555555eeeeeee55eeeeeee55555555555555555
555555555ccc555555eeeeeeeeeeeeee555555ccc5777775555555555555555555555555555555555777775555555555eeeeeeeeeeeeee555555555555555555
555555555ccc5555555eeeeeeeeeeee5555555ccc57777755555555555555555555555555555555557777755555555555eeeeeeeeeeee5555555555555555555
555555555ccc55555555eeeeeeeeee55555555ccc577777555555555555555555555555555555555577777555555555555eeeeeeeeee55555555555555555555
555555555ccc555555555eeeeeeee555555555ccc5777775555555555555555555555555555555555777775555555555555eeeeeeee555555555555555555555
555555555ccc555555555eeeeeeee555555555ccc5777775555555555555555555555555555555555777775555555555555eeeeeeee555555555555555555555
555555555ccc55555555eeeeeeeeee55555555ccc577777555555555555555555555555555555555577777555555555555eeeeeeeeee55555555555555555555
555555555ccc5555555eeeeeeeeeeee5555555ccc57777755555555555555555555555555555555557777755555555555eeeeeeeeeeee5555555555555555555
555555555ccc555555eeeeeeeeeeeeee555555ccc5777775555555555555555555555555555555555777775555555555eeeeeeeeeeeeee555555555555555555
555555555ccc55555eeeeeee55eeeeeee55555ccc577777555555555555555555555555555555555577777555555555eeeeeee55eeeeeee55555555555555555
555555555ccc5555eeeeeee5555eeeeeee5555ccc57777755555555555555555555555555555555557777755555555eeeeeee5555eeeeeee5555555555555555
555555555ccc555eeeeeee555555eeeeeee555ccc5777775555555555555555555555555555555555777775555555eeeeeee555555eeeeeee555555555555555
555555555ccc55eeeeeee55555555eeeeeee55ccc577777555555555555555555555555555555555577777555555eeeeeee55555555eeeeeee55555555555555
555555555ccc5eeeeeee5555555555eeeeeee5ccc57777755555555555555555555555555555555557777755555eeeeeee5555555555eeeeeee5555555555555
555555555ccc5eeeeee555555555555eeeeee5ccc57777755555555555555555555555555555555557777755555eeeeee555555555555eeeeee5555555555555
555555555ccc5eeeee55555555555555eeeee5ccc57777755555555555555555555555555555555557777755555eeeee55555555555555eeeee5555555555555
555555555ccc55eee5555555555555555eee55ccc577777555555555555555555555555555555555577777555555eee5555555555555555eee55555555555555
555555555ccc55555555555555555555555555ccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555cccccccccccccccccccccccccccccccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
555555555cccccccccccccccccccccccccccccccc577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
5555555555cccccccccccccccccccccccccccccc5577777555555555555555555555555555555555577777555555555555555555555555555555555555555555
55555555555555555555555555555555555555555557775555555555555555555555555555555555557775555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555

